<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="常用的 Referrer Policy 规定 Referrer 策略"><title>Referrer 策略 - Yakeing Blog</title><link rel=stylesheet href=https://cdn.bootcss.com/pure/1.0.1/pure-min.css><link rel=stylesheet href="/css/side-menu.css?v="><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/content-detailed.css><link rel=stylesheet href=https://apps.bdimg.com/libs/fontawesome/4.1.0/css/font-awesome.min.css><link rel=stylesheet href=https://cdn.bootcss.com/highlight.js/9.12.0/styles/androidstudio.min.css><script src=https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js></script><script>hljs.initHighlightingOnLoad();</script><script type=text/javascript src=https://cdn.bootcdn.net/ajax/libs/qrcodejs/1.0.0/qrcode.min.js></script><meta name=referrer content="no-referrer-when-downgrade"><meta name=Access-Control-Allow-Origin content="*"><meta name=Access-Control-Max-Age content="1728000"><meta name=Access-Control-Allow-Credentials content="true"><meta name=Access-Control-Request-Method content="OPTIONS, GET, PUT, POST, DELETE"><meta name=Access-Control-Allow-Headers content="x-requested-with, accept, origin, content-type"><script async src=https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js defer></script><link rel="shortcut icon" href=/favicon.ico type=image/x-icon></head><!--[if gt IE 8]><![endif]--><body><div id=layout><a href=javascript:window.scrollTo(0,0); id=BackToTop alt="Back To Top" title="Back To Top"><div><i class="fa fa-arrow-circle-up fa-fw"></i></div></a><div id=menuButton><a href=javascript:void(0); id=menuLink class=menu-link><div class=link><span></span></div></a><div class=title>Yakeing Blog</div></div><div id=menu><div class="avatar rotate"><a href=/><img src=/img/avatar.png title=Yakeing></a></div><div class=pure-menu><ul class=pure-menu-list><li class=pure-menu-item><a class=pure-menu-link href=/><i class="fa fa-home fa-fw"></i>首页</a></li><li class=pure-menu-item><a class=pure-menu-link href=/tags.html><i class="fa fa-tags fa-fw"></i>标签</a></li><li class=pure-menu-item><a class=pure-menu-link href=/categories.html><i class="fa fa-bookmark fa-fw"></i>分类</a></li><li class=pure-menu-item><a class=pure-menu-link href=/post.html><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="pure-menu-item pure-menu-has-children"><a class=pure-menu-link href=javascript:void(0);><i class="fa fa-gear fa-fw"></i>关于</a><ul class=pure-menu-children><li class=pure-menu-item><a class=pure-menu-link href=/author.html><i class="fa fa-user fa-fw"></i>作者</a></li><li class=pure-menu-item><a class=pure-menu-link href=/resources.html><i class="fa fa-gears fa-fw"></i>资源</a></li><li class=pure-menu-item><a class=pure-menu-link href=/icon.html><i class="fa fa-star-half-empty fa-fw"></i>图标</a></li><li class=pure-menu-item><a class=pure-menu-link href=/copyright.html><i class="fa fa-lock fa-fw"></i>版权</a></li><li class=pure-menu-item><a class=pure-menu-link href=/sitemap.xml><i class="fa fa-globe fa-fw"></i>地图</a></li></ul></li></ul></div><div class=social-menu><a href=https://github.com/yakeing rel="noopener noreferrer" target=_blank><i class="fa fa-github-square fa-2x"></i></a><a href=https://twitter.com/yakeing rel="noopener noreferrer" target=_blank><i class="fa fa-twitter-square fa-2x"></i></a><a href=https://weibo.com/yakeing rel="noopener noreferrer" target=_blank><i class="fa fa-weibo fa-2x"></i></a></div><div class=copyright><div class=small-print><small>&copy;<span class=separator>2021</span><i class="fa fa-heart heart"></i><span class=separator>Yakeing</span></small></div><div class=small-print><div><small>由<span class=separator><b>Hugo</b></span>强力驱动</small></div><div><small>主题<span class=separator><b>king</b></span></small></div><div><small>版权<span class=separator><b>CC BY-SA 4.0</b></span></small></div><div><span id=busuanzi_container_site_pv>访问<span id=busuanzi_value_site_pv class=separator>999+</span>次</span></div></div></div></div><div id=main><div class=header><h1>Referrer 策略</h1><h2>常用的 Referrer Policy 规定 Referrer 策略</h2></div><div class=content><div class=post-meta><div class=blob-path><i class="fa fa-home fa-fw"></i>位置:<a href=/ class=separator>HONE</a>/
<a href=/categories/Default.html class=separator>Default</a></div><div><i class="fa fa-user fa-fw"></i>作者:<span class=separator><b>Yakeing</b></span></div><div><i class="fa fa-font fa-fw"></i>字节:<span class=separator><b>2197</b></span>(Byte)</div><div><i class="fa fa-clock-o fa-fw"></i>时间:<span class=separator><time><b>2020-11-02 01:57:52</b></time></div><div><span id=busuanzi_container_page_pv style=display:inline><i class="fa fa-eye fa-fw"></i>阅读:<b><span id=busuanzi_value_page_pv class=separator>999+</span></b>次</span></div><div><i class="fa fa-tags fa-fw"></i>标签:</div><div class=taxonomies><ul class="pure-menu-list tags"><a href=/tags/Code.html><li class=pure-button-active><i class="fa fa-tag fa-fw"></i>Code</li></a></ul></div></div><div class="content_detailed content_image" id=content_string><div class=TableOfContents><b>目录：</b><br><nav id=TableOfContents><ul><li><ul><li><a href=#referrer-policy>Referrer Policy</a></li><li><a href=#五种常用-referrer-策略>五种常用 Referrer 策略</a></li><li><a href=#候选标准-referrer-策略>候选标准 Referrer 策略</a></li><li><a href=#改变策略方法>改变策略方法</a></li><li><a href=#总结>总结</a></li></ul></li></ul></nav></div><p><h3 id=referrer-policy>Referrer Policy</h3><p>在页面引入图片、JS 等资源或者当一个用户点击当前页面中的一个链接，然后跳转到目标页面时，目标页面会收到一个信息，即用户是从哪个源链接跳转过来的。也就是说，当你发起一个 <strong>http</strong> 请求，请求头中的 <strong>referrer</strong> 字段就说明了你是从哪个页面发起该请求的。</p><p>特别使用 <strong>网站统计</strong> 和做 <strong>广告联盟</strong> 的因为没有页面地址无法准确判断页面给出正确结果甚至可能被判违规。</p><p><strong>Referrer</strong> 在分析用户来源时很有用，有着广泛的使用。但 URL 可能包含用户敏感信息，如果被第三方网站拿到很不安全（例如之前不少 Wap 站把用户 <strong>SESSION ID</strong> 放在 URL 中传递，第三方拿到 URL 就可以看到别人登录后的页面）。之前浏览器会按自己的默认规则来决定是否加上 <strong>Referrer</strong>。　</p><p><img src=https://cdn.jsdelivr.net/gh/yakeing/Documentation@main/Hugo/images/Referrer.jpg alt=Referrer></p><h4 id=general>General</h4><p>可以看见 <strong>Referrer</strong> 的策略是 <code>strict-origin-when-cross-origin</code></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html>Request URL: https://github.com/yakeing
Request Method: GET
Status Code: 200
Remote Address: 97.64.23.206:443
Referrer Policy: strict-origin-when-cross-origin
</code></pre></div><h4 id=request-headers>Request Headers</h4><p>因为策略问题使得 <strong>Referrer</strong> 来源地址并非当前页面地址。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html>accept: */*
accept-encoding: gzip, deflate, br
accept-language: zh-CN,zh;q=0.9
referer: https://yake.tk
user-agent: Mozilla/5.0 (Windows) Chrome/99.111 Safari/567.36
</code></pre></div><h3 id=五种常用-referrer-策略>五种常用 Referrer 策略</h3><table><thead><tr><th style=text-align:left>策略</th><th style=text-align:left>属性值</th><th style=text-align:left>作用</th></tr></thead><tbody><tr><td style=text-align:left>No Referrer</td><td style=text-align:left>no-referrer (never)</td><td style=text-align:left>不发送</td></tr><tr><td style=text-align:left>No Referrer When Downgrade</td><td style=text-align:left>no-referrer-when-downgrade (default)</td><td style=text-align:left>降级时不发送(HTTPS降HTTP)</td></tr><tr><td style=text-align:left>Origin Only</td><td style=text-align:left>origin</td><td style=text-align:left>仅发送域名和端口</td></tr><tr><td style=text-align:left>Origin When Cross-origin</td><td style=text-align:left>origin-when-crossorigin</td><td style=text-align:left>跨域仅发送域名和端口</td></tr><tr><td style=text-align:left>Unsafe URL</td><td style=text-align:left>unsafe-url (always)</td><td style=text-align:left>发送</td></tr></tbody></table><p>现阶段的浏览器还保留了对 never、default 和 always 的支持，但是已经不推荐使用了。</p><h3 id=候选标准-referrer-策略>候选标准 Referrer 策略</h3><h5 id=1no-referrer>1.<strong>no-referrer</strong></h5><p>从字面意思就可以理解，不传递 <strong>Referrer</strong> 报头的值。</p><h5 id=2no-referrer-when-downgrade>2.<strong>no-referrer-when-downgrade</strong></h5><p>当发生降级（比如从 <strong>https://</strong> 跳转到 <strong>http://</strong> ）时，不传递 Referrer 报头。但是反过来的话不受影响。通常也会当作浏览器的默认安全策略。</p><h5 id=3same-origin>3.<strong>same-origin</strong></h5><p>同源，即当协议、域名和端口（如果有一方指定的话）都相同，才会传递 <strong>Referrer</strong>。</p><h5 id=4origin>4.<strong>origin</strong></h5><p>将当前页面过滤掉参数及路径部分，仅将协议、域名和端口（如果有的话）当作 <strong>Referrer</strong>。</p><h5 id=5strict-origin>5.<strong>strict-origin</strong></h5><p>类似于 <strong>origin</strong>，但是不能降级。</p><h5 id=6origin-when-cross-origin>6.<strong>origin-when-cross-origin</strong></h5><p>跨域时（协议、域名和端口只有一个不同）和 <strong>origin</strong> 模式相同，否则 <strong>Referrer</strong> 还是传递当前页的全路径。</p><h5 id=7strict-origin-when-cross-origin>7.<strong>strict-origin-when-cross-origin</strong></h5><p>与 origin-when-cross-origin 类似，但不能降级。</p><h5 id=8unsafe-url>8.<strong>unsafe-url</strong></h5><p>任意情况下，都发送当前页的全部地址到 <strong>Referrer</strong>，最宽松和不安全的策略。</p><h4 id=空字符串>空字符串</h4><p>若设为空串则默认按照浏览器的机制设置 <strong>referrer</strong> 的内容，默认情况下是和 <code>no-referrer-when-downgrade</code> 设置得一样。</p><h4 id=什么是跨域>什么是跨域</h4><p>跨域是指跨域名的访问，以下情况都属于跨域</p><ul><li>域名不同</li><li>域名相同，端口不同</li><li>二级域名不同</li></ul><h3 id=改变策略方法>改变策略方法</h3><p>通过 <code>Referrer-Policy</code> <strong>HTTP header</strong> 设置：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html>Referrer-Policy: no-referrer-when-downgrade
</code></pre></div><p>通过指定 <code>name</code> 值为 <strong>referrer</strong> 的 <code>meta</code> 标签，可以达到效果：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html>&lt;<span style=color:#f92672>meta</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;referrer&#34;</span> <span style=color:#a6e22e>content</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;no-referrer-when-downgrade&#34;</span>&gt;
</code></pre></div><p>配置好之后再次打开页面刷新测试一下.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html>accept: */*
accept-encoding: gzip, deflate, br
accept-language: zh-CN,zh;q=0.9
referer: https://yake.tk/post/***.html
user-agent: Mozilla/5.0 (Windows) Chrome/99.111 Safari/567.36
</code></pre></div><p>可以看见 <strong>Referrer</strong> 来源地址与页面地址一致。</p><h4 id=标签属性>标签属性</h4><p><code>a</code> 和 <code>link</code> 标签可以通过属性 <code>rel</code> 指定 <strong>noreferrer</strong>，仅对当前链接有效；
<code>a</code>、<code>area</code>、<code>link</code>、<code>iframe</code> 和 <code>img</code> 还可以通过 <strong>referrerpolicy</strong> 指定仅针对当前链接的设置。</p><h3 id=总结>总结</h3><p>可以看到，通过改变 <strong>Referrer</strong> 策略，网站所有者可以选择更高的安全级别来保证用户隐私不被泄露；也可以选择更低的安全级别来获得一些便利，相比之前只能由浏览器默认策略一刀切，确实灵活了不少。</p></p></div><div>如果文章图片不显示请点击<span class=separator><a href=javascript:void(0); onclick="purgeJsdelivrCache('yakeing/Documentation@master/images/2020-11/Referrer.jpg');return false;" alt=purgeCache title=purgeCache>CDN图片缓存</a></span>更新</div><div id=reward><div class=reward-box><div id=rewardQR style=display:none><img src=/img/WeChat.png class=float-left alt=WeChat title=WeChat>
<img src=/img/Alipay.png class=float-right alt=Alipay title=Alipay></div><a href=javascript:void(0); onclick="Displaying('rewardQR');return false;" alt=赞赏 title=赞赏><div class="reward-button rotate-spin">赏</div></a></div></div><div id=share><div id=qrcodeQR style=display:none></div>分享到:<span class=separator>
<a href=javascript:void(0); onclick="Displaying('qrcodeQR');return false;" alt=WeChat title=WeChat><i class="fa fa-wechat fa-2x"></i></a><a href=javascript:void(0); onclick="TencentBox('QQ');return false;" alt=QQ title=QQ><i class="fa fa-qq fa-2x"></i></a><a href=javascript:void(0); onclick="WeiboBox();return false;" alt=Weibo title=Weibo><i class="fa fa-weibo fa-2x"></i></a><a href=javascript:void(0); onclick="TwitterBox();return false;" alt=Twitter title=Twitter target=_blank><i class="fa fa-twitter fa-2x"></i></a></span></div><script type=text/javascript>var qrcode=new QRCode(document.getElementById("qrcodeQR"),{text:"https:\/\/yake.tk\/post\/Referrer.html",width:150,height:150,colorDark:"#000000",colorLight:"#ffffff",correctLevel:QRCode.CorrectLevel.H});</script><div class=copyright-notice><div class=notice-title><b>&copy;版权声明:</b></div><div class=notice-content>本文内容版权归原作者所有，本文遵循<a href=/copyright.html target=_blank>《CC BY-SA 4.0》</a>版权协议，部分内容和图片有可能来自网络摘取。如果您发现本文内容中有涉嫌抄袭的内容，请联系本站管理人员一经查实，将立刻删除涉嫌侵权内容。</div></div><div class="prev-next-post pure-g"><div class=pure-u-1-24 style=text-align:left><a href=/post/HtmlStatusCode.html><i class="fa fa-chevron-left"></i></a></div><div class=pure-u-10-24><nav class=prev><a href=/post/HtmlStatusCode.html>HTML状态码</a></nav></div><div class=pure-u-2-24><span class=separator>.</span></div><div class=pure-u-10-24></div><div class=pure-u-1-24 style=text-align:right></div></div><div class=pure-menu><ul class=pure-menu-list></ul></div><div id=advertise>*advertise*</div><div class=beaudar></div><script src=https://beaudar.lipk.org/client.js repo=yakeing/HugoBlog issue-term=title label=Blog,DIGICCY theme=github-light crossorigin=anonymous async></script></div><script src=/js/publicUI.js></script><script src=/js/menus.js></script><script type=text/javascript>consoleLogCode([["Blog","#007EC6"]]);consoleLogCode([["Author","#606060"],["Yakeing","#28a745"]]);consoleLogCode([["License","#606060"],["CC BY-SA 4.0","#F44336"]]);consoleLogCode([["Hugo","#606060"],["0.75.1","#df4fa5"],["a4a7bab7","#9b95c9"]]);consoleLogCode([["BuildDate","#606060"],["2020-11-01 17:57:52 \u002b0000 UTC","#e36209"]]);</script><script>var _hmt=_hmt||[];(function(){var hm=document.createElement("script");hm.src="https://hm.baidu.com/hm.js?ce39a9b866e129aa8618b761d2ee25a5";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(hm,s);})();</script></div></div></body></html>